"0",""
"0","set.seed(21)"
"0",""
"0","# This is probably not the best workflow to get this data."
"0","# I'm really not well versed with the baseballr package."
"0","mlb_game_pks <- baseballr::mlb_schedule(2021) %>%"
"0","  filter(game_type == ""R"") %>%"
"0","  pull(game_pk) %>%"
"0","  sample(size = 500)"
"0",""
"0","raw_mlb_df <- map_df(mlb_game_pks, mlb_game_wp)"
"0",""
"0","mlb_df <- raw_mlb_df %>%"
"0","  rename(home_p = home_team_win_probability,"
"0","         home_q = away_team_win_probability) %>%"
"0","  mutate(home_p = home_p / 100,"
"0","         home_q = home_q / 100) %>%"
"0","  select(at_bat_index, home_p, home_q) %>%"
"0","  mutate(movement = NA_real_,"
"0","         reduction = NA_real_)"
"0",""
"0","wp_movement_mlb <- function(df){"
"0","  for(i in 1:nrow(df)){"
"0","    if(df$at_bat_index[i] == 0){"
"0","      df$reduction[i] = NA_real_"
"0","      df$movement[i] = NA_real_"
"0","    }"
"0","    else {"
"0","      df$reduction[i] = (df$home_p[i - 1]*df$home_q[i - 1]) - (df$home_p[i]*df$home_q[i])"
"0","      df$movement[i] = (df$home_p[i] - df$home_p[i-1])^2"
"0","    }"
"0","  }"
"0","  "
"0","  return(df)"
"0","}"
"0",""
"0","mlb_excess <- mlb_df %>%"
"0","  wp_movement_mlb()"
"0",""
