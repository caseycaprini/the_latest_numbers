"0",""
"0","# Load 2011-2020 data set prepared previously"
"0","results_df <- read.csv(""win_loss_mvt_distribution_2011_2020.csv"")"
"0",""
"0",""
"0","# Logistic regressions"
"0","# Estimated win probability as function of time average lead"
"0","# Separate models fit for home games and away games"
"0","mod_home <- glm(win ~ mean_point_diff,"
"0","                family = ""binomial"","
"0","                data = results_df %>% filter(home_away == ""home""))"
"0","home_int_coef = coef(mod_home)[1]"
"0","home_tal_coef = coef(mod_home)[2]"
"0","mod_away <- glm(win ~ mean_point_diff,"
"0","                family = ""binomial"","
"0","                data = results_df %>% filter(home_away == ""away""))"
"0","away_int_coef = coef(mod_away)[1]"
"0","away_tal_coef = coef(mod_away)[2]"
"0",""
"0",""
"0","# Load 2021 time average results by week"
"0","# Add model predicted win percentage for each game played"
"0","df_weekly = nfl_mvt_season(2021)"
"2","Note: nflreadr caches (i.e., stores a saved version) data by default.
If you expect different output try one of the following:
[34mi[39m Restart your R Session or
[34mi[39m Run `nflreadr::.clear_cache()`.
To disable this warning, run `options(nflreadr.cache_warning = FALSE)`"
"0","df_weekly = df_weekly %>%"
"0","  rename(tal = mean_point_diff) %>%"
"0","  mutate(exp_wins = ifelse(home_away == ""home"","
"0","                           exp(home_int_coef + home_tal_coef*tal)/(1 + exp(home_int_coef + home_tal_coef*tal)),"
"0","                           exp(away_int_coef + away_tal_coef*tal)/(1 + exp(away_int_coef + away_tal_coef*tal)))"
"0","  )"
"0",""
"0",""
"0","# Compute sum of expected wins projected by model for each team"
"0","# Add actual wins and pythag win expectation"
"0","# Compute ""luck"" estimates (i.e., wins > projected)"
"0","exp_results <- df_weekly %>%"
"0","  filter(is.na(home_away) == F) %>%"
"0","  group_by(team) %>%"
"0","  summarize(games = n(),"
"0","            exp_wins = sum(exp_wins))"
"0","exp_results <- left_join(nfl_reg_season_summary(2021) %>%"
"0","                           select(team, wins, pythag_wins),"
"0","                         exp_results,"
"0","                         by = c(""team"" = ""team""))"
"0","exp_results <- exp_results %>%"
"0","  mutate(exp_win_luck = wins - exp_wins,"
"0","         pythag_win_luck = wins - pythag_wins)"
"0",""
