"0","year = 2021"
"0","week = 16"
"0",""
"0","nfl_hold_pbp_df <- load_pbp(year) %>%"
"0","  filter(week <= week) %>%"
"0","  filter(grepl(""Offensive Holding"", desc,"
"0","               ignore.case = T) == T) %>%"
"0","  filter(grepl(""punts"", desc) == F) %>%"
"0","  filter(grepl(""kicks"", desc) == F) %>%"
"0","  mutate(season = year) %>%"
"0","  mutate(off_hold_play_type = case_when(rush_attempt == 1 ~ ""Run"","
"0","                                        pass_attempt == 1 ~ ""Pass"","
"0","                                        grepl(""pass"", desc) == T ~ ""Pass"","
"0","                                        grepl(""scrambles"", desc) == T ~ ""Pass"","
"0","                                        grepl(""sacked"", desc) == T ~ ""Pass"","
"0","                                        TRUE ~ ""Run"")) %>%"
"0","  rename(team = posteam,"
"0","         opponent = defteam) %>%"
"0","  select(season, team, week, opponent,"
"0","         desc, off_hold_play_type,"
"0","         rush_attempt, pass_attempt,"
"0","         penalty_player_id, penalty_player_name,"
"0","         series, series_success, series_result) %>%"
"0","  mutate(accept_decline = ifelse(grepl(""Offensive Holding, declined"", desc),"
"0","                                 ""declined"","
"0","                                 ""accepted""))"
"1",""
"0","# Summarize holding penalties committed by each team"
"0","team_off_hold_commit <- nfl_hold_pbp_df %>%"
"0","  group_by(team, off_hold_play_type) %>%"
"0","  summarize(n_holds = n()) %>%"
"0","  ungroup()"
"2","`summarise()` has grouped output by 'team'. You can override using the `.groups` argument.
"
"0","team_off_hold_commit_totals <- team_off_hold_commit %>%"
"0","  group_by(team) %>%"
"0","  summarize(total_holds = sum(n_holds))"
"0","team_off_hold_commit <- left_join(team_off_hold_commit, team_off_hold_commit_totals,"
"0","                               by = c(""team"" = ""team""))"
"0",""
"0","# Plot holding penalties committed"
"0","p_commit <- team_off_hold_commit %>%"
"0","  ggplot(aes(x = desc(reorder(factor(team), total_holds)),"
"0","             y = n_holds)) +"
"0","  geom_col(aes(fill = off_hold_play_type),"
"0","           width = 0.5) +"
"0","  geom_nfl_logos(aes(y = total_holds,"
"0","                     team_abbr = team),"
"0","                 width = 0.04,"
"0","                 alpha = 0.8) +"
"0","  theme_light() +"
"0","  labs(x = NULL,"
"0","       y = ""Holding Calls"","
"0","       title = ""Offensive Holding Penalties Committed in 2021"","
"0","       subtitle = ""Accepted and Declined. Thru Week 16."","
"0","       caption = ""Data: nflfastR. Plot: nflplotR"","
"0","       fill = ""Play Call:"") +"
"0","  scale_x_discrete(breaks = NULL) +"
"0","  scale_y_continuous(minor_breaks = NULL) +"
"0","  coord_flip() +"
"0","  theme(legend.position = ""bottom"")"
"0","ggsave(filename = ""nfl_2021_holds_commit_thru_wk_16.png"","
"0","       plot = p_commit,"
"0","       width = 5,"
"0","       height = 5.25,"
"0","       units = ""in"","
"0","       dpi = ""retina"")"
"0",""
"0",""
"0","# Summarize holding penalties drawn by each team"
"0","team_off_hold_drawn <- nfl_hold_pbp_df %>%"
"0","  group_by(opponent, off_hold_play_type) %>%"
"0","  summarize(n_holds = n()) %>%"
"0","  ungroup() %>%"
"0","  rename(team = opponent)"
"0","team_off_hold_drawn_totals <- team_off_hold_drawn %>%"
"0","  group_by(team) %>%"
"0","  summarize(total_holds = sum(n_holds))"
"0","team_off_hold_drawn <- left_join(team_off_hold_drawn, team_off_hold_drawn_totals,"
"0","                                  by = c(""team"" = ""team""))"
"0",""
"0","# Plot holding penalties drawn"
"0","p_drawn <- team_off_hold_drawn %>%"
"0","  ggplot(aes(x = reorder(factor(team), total_holds),"
"0","             y = n_holds)) +"
"0","  geom_col(aes(fill = off_hold_play_type),"
"0","           width = 0.5) +"
"0","  geom_nfl_logos(aes(y = total_holds,"
"0","                     team_abbr = team),"
"0","                 width = 0.04,"
"0","                 alpha = 0.8) +"
"0","  theme_light() +"
"0","  labs(x = NULL,"
"0","       y = ""Holding Calls"","
"0","       title = ""Offensive Holding Penalties Drawn in 2021"","
"0","       subtitle = ""Accepted and Declined. Thru Week 16."","
"0","       caption = ""Data: nflfastR. Plot: nflplotR"","
"0","       fill = ""Play Call:"") +"
"0","  scale_x_discrete(breaks = NULL) +"
"0","  scale_y_continuous(minor_breaks = NULL) +"
"0","  coord_flip() +"
"0","  theme(legend.position = ""bottom"")"
"0","ggsave(filename = ""nfl_2021_holds_drawn_thru_wk_16.png"","
"0","       plot = p_drawn,"
"0","       width = 5,"
"0","       height = 5.25,"
"0","       units = ""in"","
"0","       dpi = ""retina"")"
"0",""
"0",""
"0","# Net offensive hold advantage"
"0","team_net_holds <- team_off_hold_drawn_totals %>%"
"0","  rename(total_holds_drawn = total_holds) %>%"
"0","  left_join(team_off_hold_commit_totals,"
"0","            by = c(""team"" = ""team"")) %>%"
"0","  rename(total_holds_committed = total_holds) %>%"
"0","  mutate(net_holds = total_holds_drawn - total_holds_committed)"
"0","# Plot net offensive hold advantage"
"0","p_net <- team_net_holds %>%"
"0","  ggplot(aes(x = reorder(factor(team), net_holds),"
"0","             y = net_holds)) +"
"0","  geom_col(width = 0.5,"
"0","           fill = ""gray"","
"0","           alpha = 0.8) +"
"0","  geom_nfl_logos(aes(team_abbr = team),"
"0","                 width = 0.04,"
"0","                 alpha = 0.8) +"
"0","  theme_light() +"
"0","  labs(x = NULL,"
"0","       y = ""Holding Calls"","
"0","       title = ""Net Offensive Holding Penalties Drawn in 2021"","
"0","       subtitle = ""Accepted and Declined. Thru Week 16."","
"0","       caption = ""Data: nflfastR. Plot: nflplotR"") +"
"0","  scale_x_discrete(breaks = NULL) +"
"0","  scale_y_continuous(minor_breaks = NULL) +"
"0","  coord_flip() +"
"0","  theme(legend.position = ""bottom"")"
"0","ggsave(filename = ""nfl_2021_net_holds_thru_wk_16.png"","
"0","       plot = p_net,"
"0","       width = 5,"
"0","       height = 5.25,"
"0","       units = ""in"","
"0","       dpi = ""retina"")"
"0",""
"0",""
"0","#Series success rate for series with 1+ holds"
"0","hold_series_success_rate <- nfl_hold_pbp_df %>%"
"0","  group_by(team, week, series) %>%"
"0","  summarize(total_series = n_distinct(series),"
"0","            successful_series = sum(series_success)) %>%"
"0","  ungroup() %>%"
"0","  #Prevent series with multiple holds from being counted as multiple successes"
"0","  mutate(successful_series = if_else(successful_series == 0,"
"0","                                  0,"
"0","                                  1)) %>%"
"0","  summarize(total_series = sum(total_series),"
"0","            successful_series = sum(successful_series),"
"0","            rate = round((successful_series/total_series) * 100, 1)) %>%"
"0","  pull(rate)"
"0",""
"0",""
"0","# Proportion of holds by play type"
"0","run_holds <- team_off_hold_commit %>%"
"0","  filter(off_hold_play_type == ""Run"") %>%"
"0","  summarize(run_holds = sum(n_holds)) %>%"
"0","  pull(run_holds)"
"0","pass_holds <- team_off_hold_commit %>%"
"0","  filter(off_hold_play_type == ""Pass"") %>%"
"0","  summarize(pass_holds = sum(n_holds)) %>%"
"0","  pull(pass_holds)"
"0","run_hold_prop <- round((run_holds/(run_holds+pass_holds)) * 100, 1)"
