"0",""
"0","sim_season <- function(df){"
"0","  team = rep(NA_character_, nrow(df))"
"0","  w_05_perc = rep(NA_real_, nrow(df))"
"0","  w_25_perc = rep(NA_real_, nrow(df))"
"0","  w_50_perc = rep(NA_real_, nrow(df))"
"0","  w_75_perc = rep(NA_real_, nrow(df))"
"0","  w_95_perc = rep(NA_real_, nrow(df))"
"0","  "
"0","  for(i in 1:nrow(df)){"
"0","    team[i] = df$team[i]"
"0","    win_vec = replicate("
"0","      10000,"
"0","      sum(rbernoulli(n = length(df$weekly_avg_win_perc[[i]]),"
"0","                 p = df$weekly_avg_win_perc[[i]]))"
"0","    )"
"0","    w_05_perc[i] = quantile(win_vec, 0.05)"
"0","    w_25_perc[i] = quantile(win_vec, 0.25)"
"0","    w_50_perc[i] = quantile(win_vec, 0.50)"
"0","    w_75_perc[i] = quantile(win_vec, 0.75)"
"0","    w_95_perc[i] = quantile(win_vec, 0.95)"
"0","  }"
"0","  "
"0","  results_df <- data.frame(team,"
"0","                           w_05_perc,"
"0","                           w_25_perc,"
"0","                           w_50_perc,"
"0","                           w_75_perc,"
"0","                           w_95_perc)"
"0","}"
"0",""
"0","year_i = 2021"
"0",""
"0","df <- nfltools::nfl_mvt_season(year = year_i) %>%"
"0","  filter(is.na(home_away) == FALSE) %>%"
"0","  mutate(avg_win_perc = exp(0.3058 * time_avg_lead)/(1 + exp(0.3058 * time_avg_lead))) %>%"
"0","  group_by(team) %>%"
"0","  summarize(weekly_avg_win_perc = list(avg_win_perc))"
"0",""
"0",""
"0","df_wins <- sim_season(df)"
"0",""
"0","act_wins <- nfltools::nfl_reg_season_summary(year = year_i) %>%"
"0","  mutate(wins = wins + (0.5*ties)) %>%"
"0","  select(team, wins)"
"0",""
"0","df_wins <- left_join(df_wins,"
"0","                     act_wins,"
"0","                     by = c(""team"" = ""team""))"
"0",""
"0","p_win <- df_wins %>%"
"0","  ggplot(aes(x = reorder(factor(team),"
"0","                         w_50_perc),"
"0","             y = w_50_perc)) +"
"0","  geom_hline(yintercept = 8.5,"
"0","             color = ""red"") +"
"0","  geom_linerange(aes(ymin = w_05_perc,"
"0","                     ymax = w_95_perc,"
"0","                     color = team)) +"
"0","  geom_errorbar(aes(ymin = w_25_perc,"
"0","                    ymax = w_75_perc,"
"0","                    color = team),"
"0","                width = 0.5) +"
"0","  geom_point(shape = ""X"","
"0","             size = 3.5,"
"0","             aes(color = team,"
"0","                 y = wins)) +"
"0","  geom_nfl_logos(aes(team_abbr = team),"
"0","                 width = 0.04) +"
"0","  theme_light() +"
"0","  scale_color_nfl() +"
"0","  scale_x_discrete(label = NULL,"
"0","                   breaks = NULL) +"
"0","  scale_y_continuous(breaks = seq(0, 18, 2),"
"0","                     minor_breaks = NULL) +"
"0","  coord_flip() +"
"0","  labs(title = paste(year_i, ""Regular Season Time Average Expected Wins""),"
"0","       subtitle = ""X: actual. Logo: median. Bars: 25/75 quantile. Ends: 5/95th quantile."","
"0","       x = NULL,"
"0","       y = ""Wins"")"
"0",""
"0","ggsave(filename = ""2021_win_plot.png"","
"0","       plot = p_win,"
"0","       height = 5.25,"
"0","       width = 5,"
"0","       units = ""in"","
"0","       dpi = ""retina"")"
"0",""
