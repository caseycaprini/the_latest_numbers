"0",""
"0","year = 2021"
"0","week = 18"
"0",""
"0","pbp_df <- load_pbp(year) %>%"
"0","  filter(week <= week)"
"1",""
"0","trim_df <- pbp_df %>%"
"0","  filter(two_point_attempt != 1) %>%"
"0","  filter(grepl(""pass"", desc) == T) %>%"
"0","  filter((grepl(""Defensive Pass Interference"", desc) == T) |"
"0","           (grepl(""Illegal Contact"", desc) == T) |"
"0","           (grepl(""Defensive Holding"", desc) == T)) %>%"
"0","  mutate(def_penalty = case_when("
"0","    grepl(""Defensive Pass Interference"", desc) == T ~ ""DPI"","
"0","    grepl(""Illegal Contact"", desc) == T ~ ""Illegal Contact"","
"0","    grepl(""Defensive Holding"", desc) == T ~ ""Defensive Holding"""
"0","  )) %>%"
"0","  rename(team = posteam,"
"0","         opponent = defteam) %>%"
"0","  select(season, team, week, opponent,"
"0","         desc, def_penalty, penalty_yards,"
"0","         penalty_player_id, penalty_player_name) %>%"
"0","  mutate(accepted_declined = ifelse(is.na(penalty_yards) == T,"
"0","                                    ""Declined"","
"0","                                    ""Accepted""))"
"0",""
"0",""
"0","# Summarize penalties committed by each team"
"0","team_def_pass_commit <- trim_df %>%"
"0","  group_by(team, def_penalty) %>%"
"0","  summarize(n = n(),"
"0","            penalty_yards = sum(penalty_yards, na.rm = T)) %>%"
"0","  ungroup()"
"2","`summarise()` has grouped output by 'team'. You can override using the `.groups` argument.
"
"0","team_def_pass_commit_totals <- team_def_pass_commit %>%"
"0","  group_by(team) %>%"
"0","  summarize(total_def_pass_penalties_commit = sum(n),"
"0","            total_def_pass_penalty_yards_commit = sum(penalty_yards))"
"0","team_def_pass_commit <- left_join(team_def_pass_commit, team_def_pass_commit_totals,"
"0","                                  by = c(""team"" = ""team""))"
"0",""
"0","# Summarize penalties drawn by each team"
"0","team_def_pass_drawn <- trim_df %>%"
"0","  group_by(opponent, def_penalty) %>%"
"0","  summarize(n = n(),"
"0","            penalty_yards = sum(penalty_yards, na.rm = T)) %>%"
"0","  ungroup() %>%"
"0","  rename(team = opponent)"
"2","`summarise()` has grouped output by 'opponent'. You can override using the `.groups` argument.
"
"0","team_def_pass_drawn_totals <- team_def_pass_drawn %>%"
"0","  group_by(team) %>%"
"0","  summarize(total_def_pass_penalties_drawn = sum(n),"
"0","            total_def_pass_penalty_yards_drawn = sum(penalty_yards))"
"0","team_def_pass_drawn <- left_join(team_def_pass_drawn, team_def_pass_drawn_totals,"
"0","                                 by = c(""team"" = ""team""))"
"0",""
"0","# Net penalty advantage"
"0","team_net_def_pass <- team_def_pass_drawn_totals %>%"
"0","  left_join(team_def_pass_commit_totals,"
"0","            by = c(""team"" = ""team"")) %>%"
"0","  mutate(net_def_pass_penalties = total_def_pass_penalties_drawn - total_def_pass_penalties_commit,"
"0","         net_def_pass_penalty_yards = total_def_pass_penalty_yards_drawn - total_def_pass_penalty_yards_commit)"
"0",""
