---
title: "2021 NFL Time Average Point Differentials"
description: |
  Team time average metrics updated through Week 17.
author:
  - name: Casey Caprini
date: 01-04-2022
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(nflfastR)
library(nfltools)
library(reactable)
library(reactablefmtr)
library(nflplotR)

weekly_2021 <- nfl_mvt_season(year = 2021)
season_summary_2021 <- nfl_mvt_season_summary(weekly_2021)

df <- weekly_2021 %>%
  filter(is.na(home_away) == FALSE) %>%
  group_by(team) %>%
  summarize(metal = median(mean_point_diff),
            tal = mean(mean_point_diff))

df <- df %>%
  left_join(season_summary_2021 %>%
              select(team, opp_mean_point_diff),
            by = c("team" = "team")) %>%
  rename(sos = opp_mean_point_diff) %>%
  mutate(tale = tal + sos)

results_summary <- nfl_reg_season_summary(year = 2021) %>%
  mutate(games_played = wins + losses + ties) %>%
  unite("record", wins:ties, sep = "-") %>%
  mutate(avg_point_diff = season_point_diff/games_played)

df <- df %>%
  left_join(results_summary %>%
              select(team, record, avg_point_diff),
            by = c("team" = "team"))

df <- teams_colors_logos %>%
  select(team_logo_espn,
         team_abbr) %>%
  left_join(df,
            by = c("team_abbr" = "team")) %>%
  rename(team = team_abbr) %>%
  filter(is.na(metal) == F)

weeks_played <- weekly_2021 %>%
  filter(is.na(home_away) == FALSE) %>%
  distinct(week) %>%
  summarize(weeks = max(week)) %>%
  pull(weeks)
```

### Graphical Summary

```{r graph, echo=FALSE, layout="l-body-outset", fig.width=5, fig.height=5}
df %>%
  ggplot(aes(x = tal, y = metal)) +
  geom_abline(slope = -1, intercept = seq(from = -18, to = 18, by = 6),
              color = "light gray") +
  geom_vline(xintercept = 0,
             color = "black") +
  geom_hline(yintercept = 0,
             color = "black") +
  geom_nfl_logos(aes(team_abbr = team),
                 width = 0.05,
                 alpha = 0.7) +
  scale_x_continuous(breaks = seq(from = -15, to = 15, by = 3),
                     minor_breaks = NULL) +
  scale_y_continuous(breaks = seq(from = -15, to = 15, by = 3),
                     minor_breaks = NULL) +
  theme_light() +
  labs(title = "2021 NFL Time Average Tiers",
       x = "Average Time Avg Lead (Points)",
       y = "Median Time Avg Lead (Points)",
       caption = "Data via nflfastR. Plot via nflplotR.") -> p

ggsave(filename = "summary_plot.png",
       plot = p,
       height = 5.25,
       width = 5,
       units = "in",
       dpi = "retina")
```

![](summary_plot.png)

### Regular Season Thru Week ```r weeks_played```

```{r table, echo=FALSE}

df %>%
  reactable(
    theme = pff(),
    defaultColDef = colDef(align = "center",
                           format = colFormat(digits = 1)),
    columns = list(
      team_logo_espn = colDef(name = " ",
                              sortable = F,
                              cell = embed_img(),
                              width = 40),
      team = colDef(name = "Team",
                    width = 70),
      metal = colDef(name = "METAL",
                     defaultSortOrder = "asc"),
      tal = colDef(name = "TAL",
                   format = colFormat(digits = 1)),
      sos = colDef(name = "SOS",
                   format = colFormat(digits = 1)),
      tale = colDef(name = "TALE",
                    format = colFormat(digits = 1)),
      record = colDef(name = "Record",
                      sortable = F),
      avg_point_diff = colDef(name = "MoV",
                              format = colFormat(digits = 1))
    ),
    pagination = F,
    highlight = T,
    #style = list(borderRight = "1px solid #eee"),
    bordered = T,
    defaultSorted = c("metal")
  )

```

### Glossary
Abbreviations used in table:

* <b>METAL</b>: MEdian Time Average Lead.
  * Median of time average leads for each game played by a team.
* <b>TAL</b>: Time Average Lead
  * Unadjusted time average lead for regular season games played
    * At any give point in regulation of 2021, team __ led by an average of __ points.
* <b>SOS</b>: Strength of Schedule
  * Opponent quality adjustment based on opponents' average TAL of opponents time average lead
  * Does not consider games against team of interest
    * E.g., SOS calculation for HOU does not include the games played against HOU    
* <b>TALE</b>: Time Average Lead Evaluation
  * Season time average lead with adjustment for opponent quality
  * TALE = TAL + SOS
* <b>MOV</b>: Margin of Victory (convention used by [Pro Football Reference](https://www.pro-football-reference.com/years/2021/))
  * Aggregate point differential for team, on per game basis
  * MOV = (Season Points Scored - Season Points Allowed)/Games Played

